{
  "type": "Task",
  "status": "in-progress",
  "project": "DynamicBlockRenderers",
  "name": "orval + zod client + typed renderer pipeline",
  "description": "Replace hand-written fetch helpers with orval-generated hooks & zod validation. Auto-generate block render stubs and scaffold real props types based on backend schemas.",
  "action_items": [
    "## ğŸ”Œ  ORVAL CLIENT",
    "[x] Install deps âœ `npm i -D orval zod openapi-typescript`",
    "[x] orval.config.js âœ uses `client: 'fetch-zod'`, outputs to `src/api`, emits zod schemas",
    "[x] `package.json` âœ `{ \"gen:api\": \"orval\", \"gen:renderers\": \"ts-node scripts/gen-renderers.ts\" }`",
    "## ğŸ–¼ï¸  RENDERER STUB GENERATOR",
    "[x] `scripts/gen-renderers.ts` âœ Reads local or remote `/schemas/index.json`, generates `{type}.v{version}.tsx` stubs",
    "[x] `blockRendererRegistry.ts` âœ Maps `{type}_v{version}` â†’ dynamic import using manifest",
    "[x] `blockRendererRegistry.data.ts` âœ Auto-generated from renderers for static mapping",
    "## ğŸ” ZOD-INFERRED TYPES",
    "[ ] **Infer schema types** âœ Use Zod's `.infer<typeof ZodSchema>` in generated stubs: each stub imports its zod schema from `src/api/schemas` and defines correct props",
    "[ ] **Typed stubs** âœ Replace `data: any` with the inferred type from `zod`, and pass it into the component props",
    "[ ] **Shared base props** âœ Create `BaseBlockRendererProps` for `blockId`, `blockType`, `blockVersion`, etc., and extend it in each typed renderer",
    "## âœ… FIRST WORKING RENDERER",
    "[ ] **Implement `Task.v2.tsx`** âœ Replace stub with a basic rendering of fields like `name`, `status`, and `description`, typed via `Zod.infer`",
    "## ğŸ§¹ REMOVE AJV",
    "[x] Deleted `src/lib/ajv.ts`, replaced with orval/zod validation",
    "## ğŸ”„ PIPELINE",
    "[ ] CI âœ Ensure `npm run gen:api && gen:renderers` runs after `backend/export_openapi.py`. Fail CI if `git diff --exit-code schemas/ src/api/` is non-zero",
    "## ğŸ› ï¸  CODE MOD",
    "[ ] Replace manual `fetchBlocks()` and `createChatRequest()` with generated hooks from `src/api/chat` and `src/api/blocks`",
    "## ğŸ“‹ METADATA TYPINGS",
    "[ ] Extend `scripts/gen-renderers.ts` or create `gen-metadata-models.ts` to fetch each `/schemas/{type}/latest` entry",
    "[ ] Convert each JSON Schema to `.zod.ts` and `.d.ts` type via `json-schema-to-zod` or `quicktype`",
    "[ ] Write output to `src/lib/block_metadata/{type}.ts`",
    "[ ] Refactor renderer stubs to use `props.data: ProjectMetadata`, etc.",
    "[ ] Optionally create a `BlockMetadataByType` type map for future narrowing"
  ],
  "success_criteria": [
    "â€¢ `Doc.v3.tsx`, `Task.v2.tsx`, etc. include real typed props based on zod schemas",
    "â€¢ `Task.v2` renders actual block metadata (not just JSON dump)",
    "â€¢ `UnknownBlockRenderer` only appears for types not in schema index",
    "â€¢ CI fails on schema/render drift",
    "â€¢ All Ajv validation fully removed",
    "â€¢ Frontend has real TS types for `ProjectMetadata`, `TaskMetadata`, etc.",
    "â€¢ Renderer components show real fields, not just `<pre>` JSON dumps",
    "â€¢ BlockRendererRegistry can narrow metadata type based on block type"
  ],
  "priority": "high"
}